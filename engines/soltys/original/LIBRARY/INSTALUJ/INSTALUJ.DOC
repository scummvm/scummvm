Program INSTALUJ.EXE - uniwersalny Instalator
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

W chwili wywoíania Instalator poszukuje w katalogu, w kt¢rym sam sië znajduje,
pliku o takiej samej nazwie i rozszerzeniu .INF, kt¢ry jest plikiem sterujÜcym,
czyli zawiera kompletny opis procesu instalacji.

Plik sterujÜcy skíada sië z wierszy tekstu, z kt¢rych kaßdy powoduje
wykonanie pewnej elementarnej operacji. Operacja moße polegaç na nadaniu
wartoûci jednemu z dostëpnych obiekt¢w lub na wykonaniu na tych obiektach
jakiegoû dziaíania, czyli funkcji. Oto lista obiekt¢w:

Title1 .. Title10  - kolejne wiersze ramki tytuíowej (tekst)
Text1 .. Text10    - kolejne wiersze ramki objaûniajÜcej (tekst)
Program            - nazwa instalowanego programu, pakietu (tekst)
Name               - nazwa (tekst)
Delay              - czas w milisekundach (liczba)
BigView            - oglÜdacz tekst¢w na caíym ekranie (0 = nie)
DosScreen          - wykorzystanie ekranu przez komendy *Command (0 = nie)
DirWarn            - wyûwietlenie ostrzeßenia o istnieniu katalogu (0 = nie)
Space              - wymagany wolny obszar dysku w Kb (liczba)

Aby nadaç wartoûç obiektowi, naleßy po jego nazwie umieûciç znak '=',
a po nim nowÜ wartoûç obiektu, przy czym tekst wpisuje sië bez ßadnych
dodatkowych znak¢w ograniczajÜcych. Przykíad:

Program=Gra strategiczna "KTO"

Zmiana wartoûci obiektu sama nie wpíywa na dziaíanie instalatora, dopiero
wywoíanie funkcji operujÜcej na tym obiekcie moße ukazaç ûwiatu të zmianë.
nazwy wszystkich funkcji zaczynajÜ sië od znaku '*'. Oto lista funkcji:

*Wait        nic nie robi przez czas (w milisekundach) podany jako Delay=
*ShowTitle?  wyûwietla ramkë tytuíowÜ (zíoßonÜ z wierszy Title1..Title10)
             po dojûciu przez Instalator do oczekiwania na klawisz
*ShowTitle   wyûwietla ramkë tytuíowÜ (zíoßonÜ z wierszy Title1..Title10)
             natychmiast po wydaniu tego polecenia
*ShowText?   wyûwietla ramkë objaûnie§ (zíoßonÜ z wierszy Text1..Text10)
             po dojûciu przez Instalator do oczekiwania na klawisz
*ShowText    wyûwietla ramkë objaûnie§ (zíoßonÜ z wierszy Text1..Text10)
             natychmiast po wydaniu tego polecenia
*HideTitle   usuwa ramkë tytuíowÜ z ekranu
*HideText    usuwa ramkë objaûnie§ z ekranu
*GetAnyKey   oczekuje na naciûniëcie dowolnego klawisza
*Menu        przedstawia ramkë zíoßonÜ z wierszy Text1..Text10 w formie menu
             o tytule podanym jako Name= i kopiuje wybrany wiersz do Name=
*Polskie     kopiuje 18 poczÜtkowych znak¢w zmiennej Name= do tablicy polskich
             liter i od tej pory wszystkie wyûwietlane teksty sÜ przekodowywane
             z Mazovii (Üçëí§¢û¶ßèïêú•£ò†°) na podany zestaw
*Erase       usuwa z dysku plik o specyfikacji podanej jako Name=
*Copy        kopiuje plik o nazwie podanej jako Name z dysku i katalogu,
             gdzie znajduje sië Instalator, do bießÜcego katalogu
*CopyP       dziaía podobnie jak *Copy, przy czym zamienia wszystkie znaki
             "ogoniaste" z kod¢w Mazovii na okreûlone rozkazem *Polskie
*GetDrive    pozwala ußytkownikowi wybraç dysk, na kt¢rym zostanie
             zainstalowany program (pakiet), przy czym [Esc] umoßliwia
             przerwanie procesu instalacji
*GetDir      pozwala ußytkownikowi okreûliç dysk i katalog, gdzie zostanie
             zainstalowany program (pakiet), przy czym [Esc] umoßliwia
             przerwanie procesu instalacji
*CheckSpace  weryfikuje wielkoûç dostëpnego miejsca na dysku w stosunku
             do wartoûci podanej jako Space= i jeßeli miejsca jest za maío,
             to przerywa proces instalacji ze stosownym komunikatem
*ChangeDir   odpowiednik DOS-owego CD, przechodzi do katalogu podanego
             jako Name=
*MakeDir     zakíada w bießÜcym katalogu podkatalog o nazwie podanej
             jako Name= i przechodzi do niego (odpowiednik MD + CD)
*SaveDir     zapamiëtuje aktualny dysk i katalog (wywoíuje sië samoczynnie
             w chwili uruchomienia Instalatora)
*RestoreDir  powraca do katalogu zapamiëtanego poleceniem *SaveDir
*InsertPath  dopisuje do pliku AUTOEXEC.BAT w poleceniu PATH ûcießkë
             podanÜ jako Name=
*Command     wykonanie polecenia DOS podanego jako Name=
*If          wyûwietla tekst podany jako Name= w formie pytania z dwiema
             moßliwymi odpowiedziami: "Tak" lub "Nie" i w przypadku "Nie"
             pomija wszystkie polecenia aß do napotkania *Else lub *EndIf
*Else        jeßeli na pytanie wygenerowane przez poprzedzajÜcy rozkaz *If
             udzielono odpowiedzi "Tak", to nastëpujÜce po *Else polecenia
             bëdÜ pomijane aß do napotkania rozkazu *EndIf
*EndIf       ko§czy dziaíanie wszystkich poprzedzajÜcych rozkaz¢w *If i *Else
             (rozkazy te NIE mogÜ byç zagnießdßane)
*View        pozwala obejrzeç plik tekstowy o nazwie podanej jako Name=
             o objëtoûci nie przekraczajÜcej 30K
*Chain       dalsze sterowanie instalacjÜ przejmie plik o specyfikacji
             podanej jako Name=

Obiekt Program jest ußywany w r¢ßnych komunikatach, kt¢re wymagajÜ stosowania
nazwy firmowej instalowanego programu. Naleßy uwaßaç, by nazwa ta nie byía
díußsza niß 30 znak¢w, bo miejsce na komunikaty na ekranie podlega oczywistym
ograniczeniom.

Typowy program strujÜcy instalacjÜ zaczyna sië od wyboru dysku:

Name=C:\DOWOL
*GetDrive

Funkcja wyboru wstawia literë okreûlajÜcÜ dany napëd bezpoûrednio do obiektu
Name, dlatego trzeba przed jej wykonaniem wpisaç tu okreûlenie katalogu
docelowego. OtrzymanÜ wartoûç Name ußywa sië nastëpnie w funkcjach

*InsertPath
*MakeDir

aby dopisaç jÜ do listy PATH w pliku AUTOEXEC.BAT i wykreowaç katalog. Zbëdne
jest przechodzenie do utworzonego katalogu, gdyß MakeDir robi to automatycznie.
Nastëpnie kolejne pary

Name=PROG1.EXE
*Copy
Name=PROG2.COM
*Copy

itd. powodujÜ przeniesienie do utworzonego katalogu kolejnych plik¢w.

W zaleßnoûci od potrzeb moßna w miëdzyczasie wyûwietlaç na ekranie r¢ßne
teksty w dw¢ch ramkach: g¢rnej (Title) i dolnej (Text). Kaßda z nich jest
tablicÜ dziesiëciu obiekt¢w tekstowych, odpowiadajÜcych wierszom ramki
na ekranie. PoczÜtkowo wszystkie wiersze sÜ puste. Dlatego przy pierwszym
ich ußyciu moßna odstëpy na ekranie uzyskaç przez proste pominiëcie wierszy.
Jednak przy p¢¶niejszym wyûwietlaniu tekst¢w naleßy uwaßaç, by w pominiëtym
wierszu nie zostaí stary tekst. Lepiej wyszczeg¢lniç wszystkie linijki,
takße puste.


wersja 1.16
~~~~~~~~~~~
Poprawiono algorytm poszukiwania ûcießki dostëpu na liûcie polecenia PATH.
Dotychczas np. przy poszukiwaniu C:\LAMPA instalator zadowalaí sië napisem
C:\LAMPART;


wersja 1.17
~~~~~~~~~~~
Zmieniono spos¢b reagowania na brak wskazanego pliku przy wykonaniu polecenia
*Erase. Dotychczas taka systuacja powodowaía awaryjne przerwanie instalacji,
a obecnie jest ignorowana.

Zmieniono dziaíanie polece§ *HideTitle i *HideText. Dotychczas nie miaíy one
wpíywu na zawartoûç wierszy tekstu Title1..Title10 i Text1..Text10, a obecnie
kasujÜ odpowiednio te teksty.


wersja 1.20
~~~~~~~~~~~
Poprawiono bíÜd, kt¢ry powodowaí badanie wolnego miejsca na niewíaûciwym
dysku w przypadku ußycia do wyboru dysku polecenia *GetDir.


wersja 1.24
~~~~~~~~~~~
Poprawiono mechanizm konwersji polskich liter dla tekst¢w wyûwietlanych przez
instalator. Wskutek modyfikacji procedur bibliotecznych konwersja nie dziaíaía
w kilku ostatnich wersjach programu.


wersja 1.25
~~~~~~~~~~~
Poprawiono mechanizm konwersji polskich liter dla tekstu wyûwietlanego przez
instalator w pytaniu generowanym przez polecenie *If.


wersja 1.50
~~~~~~~~~~~
Generalna zmiana: przejûcie z jëzyka C na C++. Wprowadzono nowe, obiektowe
procedury wejûcia/wyjûcia. Dodano wewnëtrzny dekompresor plik¢w metodÜ LZW.
Dodano moßliwoûç íÜczenia kilku dekompresowanych plik¢w w jednÜ caíoûç.
Wprowadzono paskowy wska¶nik zaawansowania procesu dekompresji.

Zawieszono dziaíanie mechanizmu przenoszÜcego bez zmian datë i czas kopiowanego
pliku.


wersja 1.55 (25.01.95)
~~~~~~~~~~~~~~~~~~~~~~
Dodano moßliwoûç íÜczenia kilku kopiowanych plik¢w w jeden oraz paskowy
wska¶nik zaawansowania kopiowania. Dotychczas w te moßliwoûci byí uzbrojony
tylko dekompresor.

Wprowadzono mechanizm przenoszenia bez zmian daty i czasu pliku zar¢wno
podczas kopiowania jak i dekompresji. W przypadku lÜczenia kilku plik¢w
plik wynikowy otrzymuje datë OSTATNIEGO pliku ¶r¢díowego.

Wprowadzono samoczynny wyb¢r dysku w prototypie katalogu w poleceniu *GetDir.
Jeßeli drugim znakiem tekstu w zmiennej Name jest dwukropek, to jako pierwszy
znak zostanie wstawione oznaczenie domyûlnego napëdu dysk¢w. 


wersja 1.70 (10.11.95)
~~~~~~~~~~~~~~~~~~~~~~
Wprowadzono skuteczniejszy algorytm kompresji/dekompresji.
